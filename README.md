# KPO_Callback_Service
Серверное приложение для отслеживания маршрута сообщения

## Для всех:
Ваше приложение должно два раза выполнить post-запрос (путь запроса: [/callback](/openapi.yaml#L9), тело запроса: [Event](/openapi.yaml#L59)):

- Когда ваше приложение принимает сообщение из другого приложения или от пользователя, или это невозможно сделать вследствие возникшей ошибки (текст ошибки необходимо передать в поле [errorDescription](/openapi.yaml#L82)). Тогда некоторые поля [Event](/openapi.yaml#L59) описываются так:
  - [action](/openapi.yaml#L69): RECEIVE;
  - [from](/openapi.yaml#L71): приложение, с которого получено сообщение;
  - [to](/openapi.yaml#L76): ваше приложение.
- Когда ваше приложение отправляет сообщение в другое приложение или показывает пользователю, или это невозможно сделать вследствие возникшей ошибки (текст ошибки необходимо передать в поле [errorDescription](/openapi.yaml#L82)). Тогда некоторые поля [Event](/openapi.yaml#L59) описываются так:
  - [action](/openapi.yaml#L69): SEND;
  - [from](/openapi.yaml#L71): ваше приложение;
  - [to](/openapi.yaml#L76): приложение, в которое отправлено сообщение.

Взаимодействие с сервером подробно описано в файле [openapi.yaml](/openapi.yaml).

## Для frontend:
У сервера открыт websocket предназначенный для отображения текущего пути сообщения.
После того как очередное приложение успешно выполнит запрос на сервер, websocket всем слушателям продублирует содержимое запроса в строке вида JSON содержащую Event (см. [openapi.yaml](/openapi.yaml#L59)).
```
ws://ip-адрес:23052/logger
```

## Подключение
### Использование сервера в облаке
Этот сервер развёрнут в облаке. Для подключения используйте следующий адрес:
```
http://51.250.41.245:23052
```
### Локально - запуск в Docker (только тестирование)
Убедитесь, что у вас установлен git и запущен Docker. В терминале:

1. Импортируйте этот проект в любую удобную папку, например kpo_callback_service
```
git clone https://github.com/andrzahar/KPO_Callback_Service.git kpo_callback_service
```
2. Откройте эту папку
```
cd kpo_callback_service
```
3. Соберите (этот шаг долгий)
```
docker build -t kpo_callback_service .
```
4. Запустите
```
docker run -p 23052:23052 kpo_callback_service
```
5. Если появилась эта строка, то сервер запущен успешно! Терминал не закрывайте, он понадобится для тестирования.
```
[DefaultDispatcher-worker-1] INFO ktor.application - Responding at http://0.0.0.0:23052
```
Сервер будет доступен по следующему URL:
```
http://ip-адрес-вашего-компьютера:23052
```

## Тестирование
Для тестирования выполнения запросов из вашего приложения запустите их.
Если в терминале появилось сообщение Post successful! - запросы выполняются как правильно. В противном случае будет выведен текст ошибки.
Метод Post принимает необязательный параметр [/debug](/openapi.yaml#L15). Если он ```true```, то сервер в ответе будет отправлять подробную информацию о возникшей ошибке. 